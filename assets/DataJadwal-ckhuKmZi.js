import{r as o,u as ne,j as e}from"./index-D7BPkl7L.js";import{a as m}from"./index-xsH4HHeE.js";import{L as M,A as oe}from"./Layout-CvxaU38W.js";import{m as D,w as de,x as ce,u as me,v as ue,r as xe,s as he,j as pe,a as be,D as ge,E as je,n as fe,o as ye}from"./proxy-CFRt1oNv.js";function _e(){const[w,v]=o.useState([]),[F,u]=o.useState(!1),[j,c]=o.useState(null),[f,T]=o.useState(null),[B,h]=o.useState(!1),[_,S]=o.useState(!1),[z,C]=o.useState(null),[K,J]=o.useState([]),[q,G]=o.useState([]),y=ne(),[L,$]=o.useState(null),[k,U]=o.useState(""),[H,A]=o.useState([]),P=["08:50 - 10:30","10:40 - 12:20","12:30 - 14:10","14:20 - 16:00","16:15 - 17:55","18:05 - 18:55","19:05 - 19:55"],R=["Lab 1","Lab 2","Lab 3","Lab 4","Lab 5","Lab 6"],O=["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU"],[l,N]=o.useState({mata_kuliah_id:"",dosen_id:"",hari:"SENIN",jam_mulai:"",jam_selesai:"",lab:"Lab 1",kelas:"",semester:""});o.useEffect(()=>{const a=localStorage.getItem("token");if(!a){y("/login");return}try{const s=JSON.parse(atob(a.split(".")[1]));if(s.role!=="admin"){y("/unauthorized");return}T({id:s.user_id,role:s.role,...s})}catch(s){console.error("Token parsing error:",s),localStorage.removeItem("token"),y("/login")}},[y]),o.useEffect(()=>{if(!(f!=null&&f.id))return;(async()=>{var s,t;try{u(!0),c(null);const r=await m.get("http://localhost:8080/api/admin/jadwal",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),d=await m.get("http://localhost:8080/api/admin/mata-kuliah",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),n=await m.get("http://localhost:8080/api/admin/dosen",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});v(r.data),A(r.data),J(d.data),G(n.data)}catch(r){console.error("Fetch error:",r),c(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Gagal memuat data")}finally{u(!1)}})()},[f]),o.useEffect(()=>{const a=X(k);A(a)},[k,w]);const W=a=>{const[s,t]=a.split(" - ");N({...l,jam_mulai:s,jam_selesai:t})},X=a=>{if(!a)return w;const s=a.toLowerCase();return w.filter(t=>{var r,d,n,i,p,b,g,E,I;return((d=(r=t.mata_kuliah)==null?void 0:r.nama)==null?void 0:d.toLowerCase().includes(s))||((i=(n=t.mata_kuliah)==null?void 0:n.kode)==null?void 0:i.toLowerCase().includes(s))||((b=(p=t.dosen)==null?void 0:p.nama)==null?void 0:b.toLowerCase().includes(s))||((g=t.kelas)==null?void 0:g.toLowerCase().includes(s))||((E=t.lab)==null?void 0:E.toLowerCase().includes(s))||((I=t.hari)==null?void 0:I.toLowerCase().includes(s))||`${t.jam_mulai}-${t.jam_selesai}`.includes(s)})},x=a=>{const{name:s,value:t}=a.target;N({...l,[s]:t})},Q=()=>{S(!1),C(null),N({mata_kuliah_id:"",dosen_id:"",hari:"SENIN",jam_mulai:"",jam_selesai:"",lab:"Lab 1",kelas:"",semester:""}),h(!0)},V=a=>{S(!0),C(a),N({mata_kuliah_id:a.mata_kuliah_id,dosen_id:a.dosen_id,hari:a.hari,jam_mulai:a.jam_mulai,jam_selesai:a.jam_selesai,lab:a.lab,kelas:a.kelas,semester:a.semester}),h(!0)},Y=async a=>{var s,t,r,d;a.preventDefault();try{if(u(!0),c(null),!l.mata_kuliah_id||!l.dosen_id||!l.hari||!l.jam_mulai||!l.jam_selesai||!l.lab||!l.kelas||!l.semester){c("Harap isi semua field yang diperlukan");return}const n={mata_kuliah_id:parseInt(l.mata_kuliah_id),dosen_id:parseInt(l.dosen_id),hari:l.hari,jam_mulai:l.jam_mulai,jam_selesai:l.jam_selesai,lab:l.lab,kelas:l.kelas,semester:parseInt(l.semester)};_?await m.put(`http://localhost:8080/api/admin/jadwal/${z.id}`,n,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}}):await m.post("http://localhost:8080/api/admin/jadwal",n,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});const i=await m.get("http://localhost:8080/api/admin/jadwal",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});v(i.data),h(!1)}catch(n){console.error("Submit error:",n);const i=((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||((d=(r=n.response)==null?void 0:r.data)==null?void 0:d.error)||"Gagal menyimpan data";c(i)}finally{u(!1)}},Z=async a=>{var s,t;if(window.confirm("Apakah Anda yakin ingin menghapus jadwal ini?"))try{u(!0),await m.delete(`http://localhost:8080/api/admin/jadwal/${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});const r=await m.get("http://localhost:8080/api/admin/jadwal",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});v(r.data),le("Jadwal berhasil dihapus")}catch(r){console.error("Delete error:",r),c(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Gagal menghapus data"),ie("Gagal menghapus jadwal")}finally{u(!1)}},ee=()=>{const a={};return H.forEach(s=>{var d,n;const t=((n=(d=s.mata_kuliah)==null?void 0:d.program_studi)==null?void 0:n.nama)||"Lainnya",r=`Semester ${s.semester}`;a[t]||(a[t]={}),a[t][r]||(a[t][r]=[]),a[t][r].push(s)}),a},[ae,se]=o.useState({}),te=(a,s)=>{const t=`${a}-${s}`;se(r=>({...r,[t]:!r[t]}))},re=ee();if(F)return e.jsx(M,{children:e.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Memuat data..."})]})})});const le=a=>{$(a),setTimeout(()=>$(null),3e3)},ie=a=>{c(a),setTimeout(()=>c(null),5e3)};return e.jsx(M,{children:e.jsxs("main",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Data Jadwal"}),e.jsx("p",{className:"text-gray-600",children:"Kelola jadwal perkuliahan"}),e.jsxs(oe,{children:[j&&e.jsx(D.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0},className:"mb-4 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded",children:e.jsx("p",{children:j})}),L&&e.jsx(D.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0},className:"mb-4 p-4 bg-green-100 border-l-4 border-green-500 text-green-700 rounded",children:e.jsx("p",{children:L})})]})]}),e.jsxs("button",{onClick:Q,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(de,{className:"mr-2"})," Tambah Jadwal"]})]}),e.jsx("div",{className:"mb-6 relative",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ce,{className:"text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Cari jadwal, hari, dosen ...",className:"text-black block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:k,onChange:a=>U(a.target.value)})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden space-y-2 overflow-y-auto",style:{maxHeight:"490px"},children:Object.entries(re).map(([a,s])=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-white text-xl font-semibold bg-gradient-to-r from-blue-600 to-indigo-700 p-4",children:a}),Object.entries(s).map(([t,r])=>{const d=`${a}-${t}`,n=ae[d]!==!1;return e.jsxs("div",{children:[e.jsxs("div",{className:"text-black flex justify-between items-center p-4 bg-gray-200 cursor-pointer hover:bg-gray-400",onClick:()=>te(a,t),children:[e.jsx("h3",{className:"text-lg font-medium",children:t}),n?e.jsx(me,{}):e.jsx(ue,{})]}),n&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mata Kuliah"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hari/Jam"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kelas/Lab"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dosen"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(i=>{var p,b,g;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(xe,{className:"text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((p=i.mata_kuliah)==null?void 0:p.nama)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:((b=i.mata_kuliah)==null?void 0:b.kode)||"N/A"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:i.hari}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(pe,{className:"mr-1"}),i.jam_mulai," - ",i.jam_selesai]})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:i.kelas}),e.jsx("div",{className:"text-sm text-gray-500",children:i.lab})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"text-gray-400 mr-2"}),e.jsx("div",{className:"text-sm text-gray-900",children:((g=i.dosen)==null?void 0:g.nama)||"N/A"})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsxs("button",{onClick:()=>V(i),className:"text-blue-600 hover:text-blue-900 mr-4",children:[e.jsx(ge,{className:"inline mr-1"})," Edit"]}),e.jsxs("button",{onClick:()=>Z(i.id),className:"text-red-600 hover:text-red-900",children:[e.jsx(je,{className:"inline mr-1"})," Hapus"]})]})]},i.id)})})]})})]},d)})]},a))}),B&&e.jsx("div",{className:"fixed inset-0 drop-shadow-2xl bg-opacity-30 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white text-black rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center  px-6 py-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:_?"Edit Jadwal":"Tambah Jadwal"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-500",children:e.jsx(fe,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:Y,className:"p-6",children:[j&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:j}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mata Kuliah"}),e.jsxs("select",{name:"mata_kuliah_id",value:l.mata_kuliah_id,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Pilih Mata Kuliah"}),K.map(a=>e.jsxs("option",{value:a.id,children:[a.kode," - ",a.nama]},a.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dosen"}),e.jsxs("select",{name:"dosen_id",value:l.dosen_id,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Pilih Dosen"}),q.map(a=>e.jsx("option",{value:a.id,children:a.nama},a.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hari"}),e.jsx("select",{name:"hari",value:l.hari,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:O.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Waktu"}),e.jsxs("select",{onChange:a=>W(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Pilih Waktu"}),P.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lab"}),e.jsx("select",{name:"lab",value:l.lab,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:R.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kelas"}),e.jsx("input",{type:"text",name:"kelas",value:l.kelas,onChange:x,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Semester"}),e.jsx("input",{type:"number",name:"semester",value:l.semester,onChange:x,min:"1",max:"8",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{className:"flex justify-end pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"mr-3 px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(ye,{className:"inline mr-1"})," Simpan"]})]})]})]})})]})})}export{_e as default};
