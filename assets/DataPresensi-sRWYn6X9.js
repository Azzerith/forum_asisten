import{r as i,u as Ce,j as e}from"./index-D7BPkl7L.js";import{a as z}from"./index-xsH4HHeE.js";import{L as V,A as De}from"./Layout-CvxaU38W.js";import{m as Y,x as _e,u as Ae,v as Ee,a as Z,s as ee,j as se,o as ze,n as ae,D as Fe,B as Te,E as Be,r as Ie,z as Le}from"./proxy-CFRt1oNv.js";function Ge(){var M,$,K,G,H,O,U,J,R,W,X,q,Q;const[y,D]=i.useState([]),[te,F]=i.useState([]),[le,N]=i.useState(!1),[T,b]=i.useState(null),[v,re]=i.useState(null),[ie,_]=i.useState(!1),[l,ne]=i.useState(null),[B,I]=i.useState(null),[ce,de]=i.useState({}),[w,oe]=i.useState(""),[p,me]=i.useState("date"),[A,xe]=i.useState("desc"),[ue,E]=i.useState(null),[k,S]=i.useState(""),g=Ce(),[he,C]=i.useState(!1),[pe,ge]=i.useState(null),j=[{value:"hadir",label:"Hadir",color:"bg-green-100 text-green-800"},{value:"izin",label:"Izin",color:"bg-yellow-100 text-yellow-800"},{value:"alpha",label:"Alpha",color:"bg-red-100 text-red-800"}];i.useEffect(()=>{const s=localStorage.getItem("token");if(!s){g("/");return}try{const t=JSON.parse(atob(s.split(".")[1]));if(t.role!=="admin"){g("/");return}re({id:t.user_id,role:t.role,...t})}catch(t){console.error("Token parsing error:",t),localStorage.removeItem("token"),g("/")}},[g]),i.useEffect(()=>{if(!(v!=null&&v.id))return;(async()=>{var t,a;try{N(!0),b(null);const r=await z.get("http://localhost:8080/api/admin/presensi",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});D(r.data),F(r.data)}catch(r){console.error("Fetch error:",r),b(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Gagal memuat data")}finally{N(!1)}})()},[v]),i.useEffect(()=>{let s=[...y];if(w){const t=w.toLowerCase();s=s.filter(a=>{var r,c,m,n,d,x,u,h,f,o;return((c=(r=a.asisten)==null?void 0:r.nama)==null?void 0:c.toLowerCase().includes(t))||((n=(m=a.asisten)==null?void 0:m.nim)==null?void 0:n.toLowerCase().includes(t))||((u=(x=(d=a.jadwal)==null?void 0:d.mata_kuliah)==null?void 0:x.nama)==null?void 0:u.toLowerCase().includes(t))||((f=(h=a.jadwal)==null?void 0:h.kelas)==null?void 0:f.toLowerCase().includes(t))||((o=a.status)==null?void 0:o.toLowerCase().includes(t))})}s.sort((t,a)=>{const r=new Date(t.waktu_input),c=new Date(a.waktu_input);return A==="asc"?r-c:c-r}),F(s)},[y,w,A]);const je=()=>{const s={};return te.forEach(t=>{var n,d,x,u,h;let a,r,c,m;p==="matakuliah"?(r=((x=(d=(n=t.jadwal)==null?void 0:n.mata_kuliah)==null?void 0:d.program_studi)==null?void 0:x.nama)||"Lainnya",c=((h=(u=t.jadwal)==null?void 0:u.mata_kuliah)==null?void 0:h.nama)||"Unknown",a=`${r}-${c}`):(m=new Date(t.waktu_input).toISOString().split("T")[0],a=m),s[a]||(s[a]={key:a,programStudi:p==="matakuliah"?r:null,mataKuliah:p==="matakuliah"?c:null,date:p==="date"?m:null,items:[]}),s[a].items.push(t)}),s},fe=s=>{de(t=>({...t,[s]:!t[s]}))},ye=je(),Ne=async s=>{var t,a;try{const r=await z.delete(`http://localhost:8080/api/admin/presensi/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});D(y.filter(c=>c.id!==s)),L("Presensi berhasil dihapus"),C(!1)}catch(r){console.error("Delete error:",r),P(((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Gagal menghapus presensi"),C(!1)}},be=s=>{ge(s),C(!0)},ve=s=>{E(s.id),S(s.status)},we=()=>{E(null),S("")},ke=async s=>{var t,a,r,c,m;try{N(!0),console.log("Data yang akan dikirim:",{id:s,status:k,token:localStorage.getItem("token")});const n=await z.put(`http://localhost:8080/api/admin/presensi/${s}`,{status:k},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json",Accept:"application/json"}});console.log("Response sukses:",n.data);const d=y.map(x=>x.id===s?{...x,status:k}:x);D(d),E(null),S(""),L("Status berhasil diperbarui")}catch(n){console.error("Error detail:",{message:n.message,response:(t=n.response)==null?void 0:t.data,status:(a=n.response)==null?void 0:a.status,config:n.config});let d="Gagal memperbarui status";((r=n.response)==null?void 0:r.status)===401?(d="Sesi habis, silakan login kembali",localStorage.removeItem("token"),g("/login")):(m=(c=n.response)==null?void 0:c.data)!=null&&m.error&&(d=n.response.data.error),P(d)}finally{N(!1)}},L=s=>{I(s),setTimeout(()=>I(null),3e3)},P=s=>{b(s),setTimeout(()=>b(null),5e3)},Se=s=>{ne(s),_(!0)};return le?e.jsx(V,{children:e.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Memuat data..."})]})})}):e.jsx(V,{children:e.jsxs("main",{className:"flex-1 p-6",children:[e.jsx("div",{className:"mb-6 flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Data Presensi Asisten"}),e.jsx("p",{className:"text-gray-600",children:"Kelola data kehadiran asisten laboratorium"}),e.jsxs(De,{children:[T&&e.jsx(Y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0},className:"mb-4 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded",children:e.jsx("p",{children:T})}),B&&e.jsx(Y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0},className:"mb-4 p-4 bg-green-100 border-l-4 border-green-500 text-green-700 rounded",children:e.jsx("p",{children:B})})]})]})}),e.jsx("div",{className:"mb-6 bg-white p-4 rounded-lg shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_e,{className:"text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Cari asisten, NIM, matakuliah...",className:"text-black pl-10 pr-4 py-2 border border-gray-300 rounded-md w-full focus:outline-none focus:ring-2 focus:ring-blue-500",value:w,onChange:s=>oe(s.target.value)})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Kelompokkan:"}),e.jsxs("select",{className:"text-gray-700 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",value:p,onChange:s=>me(s.target.value),children:[e.jsx("option",{value:"matakuliah",children:"Mata Kuliah"}),e.jsx("option",{value:"date",children:"Tanggal"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Urutkan:"}),e.jsxs("select",{className:"text-gray-700 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",value:A,onChange:s=>xe(s.target.value),children:[e.jsx("option",{value:"desc",children:"Terbaru"}),e.jsx("option",{value:"asc",children:"Terlama"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden space-y-6 overflow-y-auto",style:{maxHeight:"455px"},children:Object.values(ye).map(s=>{const t=ce[s.key]!==!1;return e.jsxs("div",{children:[e.jsxs("div",{className:"text-black flex justify-between items-center p-4 bg-gray-200 cursor-pointer hover:bg-gray-400",onClick:()=>fe(s.key),children:[e.jsx("div",{children:p==="matakuliah"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium",children:s.mataKuliah}),e.jsx("p",{className:"text-sm text-gray-600",children:s.programStudi})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-medium",children:new Date(s.date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.items.length," presensi"]})]})}),t?e.jsx(Ae,{}):e.jsx(Ee,{})]}),t&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Asisten"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hari/Jam"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kelas/Lab"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Waktu Input"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items.map(a=>{var c,m,n,d,x,u,h,f;const r=j.find(o=>o.value===a.status)||{label:a.status,color:"bg-gray-100 text-gray-800"};return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center",children:(c=a.asisten)!=null&&c.photo?e.jsx("img",{src:a.asisten.photo,alt:a.asisten.nama,className:"h-full w-full object-cover rounded-full border-2 border-white",onError:o=>{o.target.onerror=null,o.target.src="https://via.placeholder.com/100?text=No+Photo"}}):e.jsx("div",{className:"h-full w-full flex items-center justify-center",children:e.jsx(Z,{className:"text-gray-500"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((m=a.asisten)==null?void 0:m.nama)||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[((n=a.asisten)==null?void 0:n.nim)||"N/A"," â€¢ ",a.jenis]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(d=a.jadwal)==null?void 0:d.hari}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(se,{className:"mr-1"}),(x=a.jadwal)==null?void 0:x.jam_mulai," - ",(u=a.jadwal)==null?void 0:u.jam_selesai]})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-gray-900",children:(h=a.jadwal)==null?void 0:h.kelas}),e.jsx("div",{className:"text-sm text-gray-500",children:(f=a.jadwal)==null?void 0:f.lab})]}),e.jsx("td",{className:"px-6 py-4",children:ue===a.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{value:k,onChange:o=>S(o.target.value),className:"text-gray-700 border border-gray-300 rounded-md px-2 py-1 text-sm",children:j.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))}),e.jsx("button",{onClick:()=>ke(a.id),className:"text-green-600 hover:text-green-800",children:e.jsx(ze,{})}),e.jsx("button",{onClick:we,className:"text-red-600 hover:text-red-800",children:e.jsx(ae,{})})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${r.color}`,children:r.label}),e.jsx("button",{onClick:()=>ve(a),className:"ml-2 text-gray-500 hover:text-blue-600",children:e.jsx(Fe,{size:14})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(a.waktu_input).toLocaleString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsxs("button",{onClick:()=>Se(a),className:"text-blue-600 hover:text-blue-900 mr-4",children:[e.jsx(Te,{className:"inline mr-1"})," Detail"]}),e.jsxs("button",{onClick:()=>be(a.id),className:"text-red-600 hover:text-red-900",children:[e.jsx(Be,{className:"inline mr-1"})," Hapus"]})]})]},a.id)})})]})})]},s.key)})}),ie&&l&&e.jsx("div",{className:"fixed inset-0 drop-shadow-2xl bg-opacity-30 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white text-black rounded-lg shadow-xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center  px-6 py-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Detail Presensi Asisten"}),e.jsx("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-gray-500",children:e.jsx(ae,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Asisten"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center",children:(M=l.asisten)!=null&&M.photo?e.jsx("img",{src:l.asisten.photo,alt:l.asisten.nama,className:"w-full h-full object-cover"}):e.jsx(Z,{className:"text-blue-600 w-5 h-5"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900",children:(($=l.asisten)==null?void 0:$.nama)||"N/A"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[((K=l.asisten)==null?void 0:K.nim)||"N/A"," â€¢ ",l.jenis]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Mata Kuliah"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Ie,{className:"text-purple-600 text-xl"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900",children:((H=(G=l.jadwal)==null?void 0:G.mata_kuliah)==null?void 0:H.nama)||"N/A"}),e.jsx("p",{className:"text-sm text-gray-500",children:((J=(U=(O=l.jadwal)==null?void 0:O.mata_kuliah)==null?void 0:U.program_studi)==null?void 0:J.nama)||"N/A"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Hari/Jam"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(R=l.jadwal)==null?void 0:R.hari}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(se,{className:"mr-1"}),(W=l.jadwal)==null?void 0:W.jam_mulai," - ",(X=l.jadwal)==null?void 0:X.jam_selesai]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Kelas/Lab"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:(q=l.jadwal)==null?void 0:q.kelas}),e.jsx("p",{className:"text-sm text-gray-500",children:(Q=l.jadwal)==null?void 0:Q.lab})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),j.find(s=>s.value===l.status)?e.jsx("span",{className:`px-3 py-1 text-sm font-semibold rounded-full ${j.find(s=>s.value===l.status).color}`,children:j.find(s=>s.value===l.status).label}):e.jsx("span",{className:"px-3 py-1 text-sm font-semibold rounded-full bg-gray-100 text-gray-800",children:l.status})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[l.isi_materi&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Isi Materi"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg h-full",children:e.jsx("p",{className:"text-gray-700",children:l.isi_materi})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:l.status==="izin"?"Bukti Izin":"Bukti Kehadiran"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg h-full",children:l.bukti_kehadiran||l.bukti_izin?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:l.status==="izin"?"Bukti izin":"Bukti kehadiran"}),e.jsxs("a",{href:l.bukti_kehadiran||l.bukti_izin,download:!0,className:"flex items-center text-blue-600 hover:text-blue-800 text-sm",children:[e.jsx(Le,{className:"mr-1"}),"Download"]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("img",{src:l.bukti_kehadiran||l.bukti_izin,alt:l.status==="izin"?"Bukti izin":"Bukti kehadiran",className:"max-h-64 w-auto object-contain",onError:s=>{s.target.onerror=null,s.target.src="https://via.placeholder.com/400x300?text=Gagal+memuat+gambar"}})})]}):e.jsx("p",{className:"text-gray-500 h-full flex items-center justify-center",children:"Tidak ada bukti"})})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx("button",{type:"button",onClick:()=>_(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Tutup"})})]})]})}),he&&e.jsx("div",{className:"fixed inset-0 drop-shadow-2xl bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Konfirmasi Hapus"}),e.jsx("p",{className:"mb-6",children:"Apakah Anda yakin ingin menghapus presensi ini?"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Batal"}),e.jsx("button",{onClick:()=>Ne(pe),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Hapus"})]})]})})]})})}export{Ge as default};
