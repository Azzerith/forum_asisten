import{r as i,j as e}from"./index-D7BPkl7L.js";import{L as B}from"./Layout-CvxaU38W.js";import{a as c}from"./index-xsH4HHeE.js";import{m as x,x as D,w as G,u as I,v as T,D as H,E as O,n as R,r as U,o as V}from"./proxy-CFRt1oNv.js";function Q(){const[_,y]=i.useState([]),[p,K]=i.useState(""),[l,j]=i.useState(null),[C,d]=i.useState(!1),[g,m]=i.useState(!1),[o,f]=i.useState({nama:"",kode:"",semester:1,program_studi_id:""}),[n,w]=i.useState({}),[M,$]=i.useState([]),[v,N]=i.useState({});i.useEffect(()=>{k(),F()},[]);const k=async()=>{var a,t;m(!0);try{const s=localStorage.getItem("token"),r=await c.get("http://localhost:8080/api/admin/mata-kuliah",{headers:{Authorization:`Bearer ${s}`}});y(r.data);const h={};r.data.forEach(b=>{h[b.program_studi.id]=!0}),N(h)}catch(s){console.error("Gagal mengambil data mata kuliah:",s),alert(`Gagal mengambil data: ${((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message}`)}finally{m(!1)}},F=async()=>{try{const a=localStorage.getItem("token"),t=await c.get("http://localhost:8080/api/admin/program-studi",{headers:{Authorization:`Bearer ${a}`}});$(t.data)}catch(a){console.error("Gagal mengambil data program studi:",a)}},E=a=>{N(t=>({...t,[a]:!t[a]}))},L=async a=>{var t,s;if(window.confirm("Apakah Anda yakin ingin menghapus mata kuliah ini?"))try{const r=localStorage.getItem("token");await c.delete(`http://localhost:8080/api/admin/mata-kuliah/${a}`,{headers:{Authorization:`Bearer ${r}`}}),y(h=>h.filter(b=>b.id!==a)),alert("Mata kuliah berhasil dihapus")}catch(r){console.error("Gagal menghapus mata kuliah:",r),alert(`Gagal menghapus: ${((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.message)||r.message}`)}},u=a=>{const{name:t,value:s}=a.target;f(r=>({...r,[t]:s})),n[t]&&w(r=>({...r,[t]:null}))},P=()=>{const a={};return o.nama.trim()||(a.nama="Nama wajib diisi"),o.kode.trim()||(a.kode="Kode wajib diisi"),o.program_studi_id||(a.program_studi_id="Program studi wajib dipilih"),w(a),Object.keys(a).length===0},z=async a=>{if(a.preventDefault(),!!P()){m(!0);try{const t=localStorage.getItem("token"),s={...o,program_studi_id:parseInt(o.program_studi_id,10),semester:parseInt(o.semester,10)};let r;l?r=await c.put(`http://localhost:8080/api/admin/mata-kuliah/${l.id}`,s,{headers:{Authorization:`Bearer ${t}`}}):r=await c.post("http://localhost:8080/api/admin/mata-kuliah",s,{headers:{Authorization:`Bearer ${t}`}}),alert(l?"Mata kuliah berhasil diperbarui":"Mata kuliah berhasil ditambahkan"),k(),d(!1)}catch(t){console.error("Gagal menyimpan mata kuliah:",t);let s="Terjadi kesalahan saat menyimpan data";t.response&&(t.response.status===400?s="Data yang dimasukkan tidak valid":t.response.status===409?s="Kode mata kuliah sudah terdaftar":s=t.response.data.message||s),alert(`Gagal: ${s}`)}finally{m(!1)}}},A=_.reduce((a,t)=>{const s=t.program_studi.id;return a[s]||(a[s]={prodi:t.program_studi,mataKuliah:[]}),a[s].mataKuliah.push(t),a},{}),S=Object.values(A).map(a=>({...a,mataKuliah:a.mataKuliah.filter(t=>t.nama.toLowerCase().includes(p.toLowerCase())||t.kode.toLowerCase().includes(p.toLowerCase()))})).filter(a=>a.mataKuliah.length>0);return i.useEffect(()=>{f(l?{nama:l.nama,kode:l.kode,semester:l.semester,program_studi_id:l.program_studi_id.toString()}:{nama:"",kode:"",semester:1,program_studi_id:""})},[l]),e.jsx(B,{children:e.jsxs("main",{className:"flex-1 p-6 overflow-x-hidden",children:[e.jsx(x.h1,{className:"text-3xl font-bold text-blue-900 mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:"Data Mata Kuliah"}),e.jsxs(x.div,{className:"bg-white p-6 rounded-xl shadow-lg",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(D,{className:"text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Cari mata kuliah...",className:"text-black w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",onChange:a=>K(a.target.value),value:p})]}),e.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors",onClick:()=>{j(null),d(!0)},children:[e.jsx(G,{className:"mr-2"}),"Tambah Mata Kuliah"]})]}),g?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{className:"space-y-2 overflow-y-auto",style:{maxHeight:"450px"},children:S.length>0?S.map(a=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-gradient-to-r from-blue-600 to-indigo-700 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>E(a.prodi.id),children:[e.jsx("h3",{className:"font-semibold text-lg text-white",children:a.prodi.nama}),e.jsx("div",{className:"text-gray-500",children:v[a.prodi.id]?e.jsx(I,{}):e.jsx(T,{})})]}),v[a.prodi.id]&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kode"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nama"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Semester"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.mataKuliah.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:t.kode}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:t.nama}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-700",children:["Semester ",t.semester]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-900 p-2 rounded-full hover:bg-blue-50 transition-colors",onClick:s=>{s.stopPropagation(),j(t),d(!0)},title:"Edit",children:e.jsx(H,{})}),e.jsx("button",{className:"text-red-600 hover:text-red-900 p-2 rounded-full hover:bg-red-50 transition-colors",onClick:s=>{s.stopPropagation(),L(t.id)},title:"Hapus",children:e.jsx(O,{})})]})})]},t.id))})]})})]},a.prodi.id)):e.jsx("div",{className:"p-6 text-center text-gray-500 border border-gray-200 rounded-lg",children:"Tidak ada data mata kuliah yang ditemukan"})})]}),C&&e.jsx(x.div,{className:"fixed inset-0 drop-shadow-2xl bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(x.div,{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-md",initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:l?"Edit Mata Kuliah":"Tambah Mata Kuliah Baru"}),e.jsx("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100",children:e.jsx(R,{size:20})})]}),e.jsxs("form",{onSubmit:z,className:"space-y-4 text-black",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Mata Kuliah"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(U,{className:"text-gray-400"})}),e.jsx("input",{type:"text",name:"nama",className:`pl-10 w-full px-4 py-2 border ${n.nama?"border-red-500":"border-gray-300"} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`,value:o.nama,onChange:u})]}),n.nama&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.nama})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kode Mata Kuliah"}),e.jsx("input",{type:"text",name:"kode",className:`w-full px-4 py-2 border ${n.kode?"border-red-500":"border-gray-300"} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`,value:o.kode,onChange:u}),n.kode&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.kode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Semester"}),e.jsx("select",{name:"semester",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:o.semester,onChange:u,children:[1,2,3,4,5,6,7,8].map(a=>e.jsxs("option",{value:a,children:["Semester ",a]},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Program Studi"}),e.jsxs("select",{name:"program_studi_id",className:`w-full px-4 py-2 border ${n.program_studi_id?"border-red-500":"border-gray-300"} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`,value:o.program_studi_id,onChange:u,children:[e.jsx("option",{value:"",children:"Pilih Program Studi"}),M.map(a=>e.jsx("option",{value:a.id,children:a.nama},a.id))]}),n.program_studi_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.program_studi_id})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",onClick:()=>d(!1),children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2"}),"Simpan"]})})]})]})]})})]})})}export{Q as default};
