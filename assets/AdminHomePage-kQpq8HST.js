import{r as l,u as I,j as t}from"./index-D7BPkl7L.js";import{L as x}from"./Layout-CvxaU38W.js";import{a as o}from"./index-xsH4HHeE.js";import{m as c}from"./proxy-CFRt1oNv.js";function H(){const[f,w]=l.useState([{title:"Total Asisten",value:"0",change:"0%",trend:"neutral"},{title:"Mata Kuliah",value:"0",change:"0",trend:"neutral"},{title:"Praktikum Aktif",value:"0",change:"0%",trend:"neutral"},{title:"Presensi Hari Ini",value:"0",change:"0",trend:"neutral"}]),[u,k]=l.useState([]),[M,v]=l.useState([]),[y,j]=l.useState(!0),b=I();l.useEffect(()=>{(async()=>{try{const i=localStorage.getItem("token");if(!i)return;const n={Authorization:`Bearer ${i}`},[s,D,S,h]=await Promise.all([o.get("http://localhost:8080/api/admin/users",{headers:n}),o.get("http://localhost:8080/api/admin/mata-kuliah",{headers:n}),o.get("http://localhost:8080/api/admin/jadwal",{headers:n}),o.get("http://localhost:8080/api/admin/presensi?limit=20",{headers:n})]),A=s.data.filter(e=>e.role==="asisten"&&e.status==="aktif").length,g=D.data.length,p=S.data.length,$=new Date().toISOString().split("T")[0],d=h.data.filter(e=>new Date(e.waktu_input).toISOString().split("T")[0]===$).length;w([{title:"Total Asisten Aktif",value:A.toString(),change:"+0%",trend:"neutral"},{title:"Mata Kuliah",value:g.toString(),change:"+0",trend:"neutral"},{title:"Praktikum Aktif",value:p.toString(),change:"0%",trend:"neutral"},{title:"Presensi Hari Ini",value:d.toString(),change:"+0",trend:"neutral"}]);const T=h.data.sort((e,r)=>new Date(r.waktu_input)-new Date(e.waktu_input)).map(e=>({id:e.id,user:e.asisten.nama,action:`melakukan presensi ${e.status}`,course:e.jadwal.mata_kuliah.nama,time:N(e.waktu_input),date:new Date(e.waktu_input).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),rawDate:new Date(e.waktu_input).toISOString().split("T")[0],rawTime:new Date(e.waktu_input).toISOString()})).reduce((e,r)=>(e[r.rawDate]||(e[r.rawDate]={date:r.date,activities:[]}),e[r.rawDate].activities.push(r),e),{}),P=Object.values(T).sort((e,r)=>new Date(r.activities[0].rawTime)-new Date(e.activities[0].rawTime));k(P),v([{title:"Verifikasi Presensi",description:`${d} presensi hari ini perlu diverifikasi`,priority:d>0?"high":"low"},{title:"Kelola Jadwal Praktikum",description:`${p} jadwal aktif`,priority:"medium"},{title:"Update Materi",description:`${g} mata kuliah tersedia`,priority:"low"}])}catch(i){console.error("Error fetching data:",i)}finally{j(!1)}})()},[]);const N=a=>{const i=new Date(a),s=Math.floor((new Date-i)/1e3);return s<60?`${s} detik yang lalu`:s<3600?`${Math.floor(s/60)} menit yang lalu`:s<86400?`${Math.floor(s/3600)} jam yang lalu`:`${Math.floor(s/86400)} hari yang lalu`},m=()=>{b("/admin/data-presensi")};return y?t.jsx(x,{children:t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"})})}):t.jsx(x,{children:t.jsxs("main",{className:"flex-1 p-6",children:[t.jsx(c.h1,{className:"text-3xl font-bold text-blue-900 mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:"Dashboard Admin"}),t.jsx("section",{className:"grid gap-6 mb-8 md:grid-cols-2 lg:grid-cols-4",children:f.map((a,i)=>t.jsx(c.div,{className:"text-white bg-gradient-to-r from-blue-600 to-indigo-700 p-6 rounded-xl shadow hover:shadow-md transition-shadow",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1,duration:.3},children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-white",children:a.title}),t.jsx("p",{className:"text-2xl font-bold mt-1",children:a.value})]}),t.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.trend==="up"?"bg-green-100 text-green-800":a.trend==="down"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:a.change})]})},i))}),t.jsx("section",{className:"grid gap-6 lg:grid-cols-3",children:t.jsxs(c.div,{className:"lg:col-span-2 bg-white p-6 rounded-xl shadow",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Aktivitas Presensi Terkini"}),u.length>0?t.jsx("div",{className:"space-y-6 overflow-y-auto",style:{maxHeight:"330px"},children:u.map((a,i)=>t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500 pb-2 sticky top-0 bg-white z-10",children:a.date}),a.activities.map(n=>t.jsxs("div",{className:"flex items-start gap-4 p-3 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer",onClick:()=>m(),children:[t.jsx("div",{className:"bg-blue-100 text-blue-600 p-2 rounded-full flex-shrink-0",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-sm font-medium text-gray-800",children:[t.jsx("span",{className:"font-semibold",children:n.user})," ",n.action," untuk ",n.course]}),t.jsx("p",{className:"text-xs text-gray-500",children:n.time})]}),t.jsx("button",{className:"text-xs cursor-pointer text-blue-600 hover:text-blue-800 flex-shrink-0",onClick:s=>{s.stopPropagation(),m()},children:"Detail"})]}))]},i))}):t.jsx("p",{className:"text-gray-500",children:"Tidak ada aktivitas presensi terkini"})]})})]})})}export{H as default};
