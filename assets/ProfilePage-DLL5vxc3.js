import{r as d,u as _,j as e}from"./index-D7BPkl7L.js";import{m,f as $,n as z,o as A,p as I,q as B,a as H,b as L,r as R,d as q}from"./proxy-CFRt1oNv.js";import{a as N}from"./index-xsH4HHeE.js";function X(){var S,U;const[i,w]=d.useState({id:"",nama:"",email:"",nim:"",telepon:"",photo:null,role:""}),[h,x]=d.useState(!1),[g,v]=d.useState(!0),[t,f]=d.useState({nama:"",email:"",nim:"",telepon:"",photo:null}),[b,k]=d.useState(0),[C,j]=d.useState(null),[E,y]=d.useState({show:!1,message:""}),[P,c]=d.useState({show:!1,message:""}),F=_();d.useEffect(()=>{(async()=>{var a,s;const r=localStorage.getItem("token");if(!r){c("Anda harus login terlebih dahulu"),v(!1);return}try{const o=JSON.parse(atob(r.split(".")[1])),p=await N.get(`http://localhost:8080/api/users/${o.user_id}`,{headers:{Authorization:`Bearer ${r}`}});if(p.data.success){const l=p.data.data;w({id:l.id,nama:l.nama||"",email:l.email||"",nim:l.nim||"",telepon:l.telepon||"",photo:l.photo||null,role:l.role||"asisten"}),f({nama:l.nama||"",email:l.email||"",nim:l.nim||"",telepon:l.telepon||"",photo:l.photo||null}),l.photo&&j(l.photo)}else c("Gagal memuat data pengguna")}catch(o){console.error("Error fetching user data:",o),c(((s=(a=o.response)==null?void 0:a.data)==null?void 0:s.message)||"Terjadi kesalahan saat memuat profil")}finally{v(!1)}})()},[]);const u=n=>{const{name:r,value:a}=n.target;f(s=>({...s,[r]:a}))},D=async n=>{if(!n)throw new Error("No file provided");if(!n.type.match("image.*"))throw new Error("Hanya file gambar yang diperbolehkan");if(n.size>10*1024*1024)throw new Error("Ukuran file terlalu besar (maksimal 10MB)");const r=new FormData;r.append("file",n),r.append("upload_preset","forum_asisten"),r.append("api_key","455624144262999");try{const a=await N.post("https://api.cloudinary.com/v1_1/azzerith/upload",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s=>{const o=Math.round(s.loaded*100/s.total);k(o)}});if(!a.data.secure_url)throw new Error("No URL returned from Cloudinary");return a.data.secure_url}catch(a){throw console.error("Cloudinary upload error:",a),a}finally{k(0)}},T=async n=>{const r=n.target.files[0];if(r)try{const a=new FileReader;a.onloadend=()=>{j(a.result)},a.readAsDataURL(r),f(s=>({...s,photo:r}))}catch(a){c({show:!0,message:a.message})}},M=async()=>{var r,a;const n=localStorage.getItem("token");if(!n){c({show:!0,message:"Anda harus login terlebih dahulu"});return}try{let s=i.photo;t.photo instanceof File&&(s=await D(t.photo));const o=new FormData;o.append("nama",t.nama),o.append("email",t.email),o.append("nim",t.nim),o.append("telepon",t.telepon),o.append("photo",s||""),console.log("Data to send:",{nama:t.nama,email:t.email,nim:t.nim,telepon:t.telepon,photo:s});const p=await N.put(`http://localhost:8080/api/users/${i.id}`,o,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"multipart/form-data"}});p.data.message==="User berhasil diperbarui"&&(w(l=>({...l,nama:t.nama,email:t.email,nim:t.nim,telepon:t.telepon,photo:s})),j(s),x(!1),y({show:!0,message:p.data.message}),c({show:!1,message:""}),setTimeout(()=>y(l=>({...l,show:!1})),3e3))}catch(s){console.error("Update error:",s),c({show:!0,message:((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||s.message||"Terjadi kesalahan saat memperbarui profil"}),y({show:!1,message:""})}finally{}};return g?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):(P.show&&P.message,E.show&&E.message,e.jsx("div",{className:"min-h-screen min-w-screen bg-gray-50 p-6",children:e.jsxs(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(m.button,{onClick:()=>F(-1),whileHover:{scale:1.05},whileTap:{scale:.95},className:"mr-4 p-2 rounded-full bg-white shadow hover:bg-gray-100 transition-colors",children:e.jsx($,{className:"w-5 h-5 text-gray-700"})}),e.jsx("h1",{className:"text-3xl font-bold text-blue-900",children:"Profil Pengguna"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("div",{}),h?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m.button,{onClick:()=>x(!1),whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg shadow hover:bg-gray-300 transition-colors",children:[e.jsx(z,{className:"w-5 h-5"}),"Batal"]}),e.jsxs(m.button,{onClick:M,whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-colors",disabled:g,children:[e.jsx(A,{className:"w-5 h-5"}),g?"Menyimpan...":"Simpan"]})]}):e.jsxs(m.button,{onClick:()=>x(!0),whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-colors",children:[e.jsx(I,{className:"w-5 h-5"}),"Edit Profil"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"bg-white rounded-xl shadow-md overflow-hidden col-span-1",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 h-24"}),e.jsxs("div",{className:"px-6 pb-6 -mt-12",children:[e.jsxs("div",{className:"flex justify-center relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-white border-4 border-white shadow-md flex items-center justify-center overflow-hidden",children:C?e.jsx("img",{src:C,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-blue-900 text-4xl font-bold",children:((U=(S=i.nama)==null?void 0:S[0])==null?void 0:U.toUpperCase())||"U"})}),h&&e.jsxs("label",{className:"absolute bottom-0 right-19 bg-white p-2 rounded-full shadow-md cursor-pointer hover:bg-gray-100",children:[e.jsx(B,{className:"w-5 h-5 text-blue-600"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:T})]})]}),b>0&&b<100&&e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${b}%`}})}),e.jsx("h2",{className:"text-center mt-4 text-xl font-semibold text-gray-800",children:i.nama||"Nama Pengguna"}),e.jsx("p",{className:"text-center text-gray-500",children:i.nim||"NIM"}),e.jsx("p",{className:"text-center text-sm text-gray-500 mt-1 capitalize",children:i.role||"asisten"})]})]}),e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"bg-white rounded-xl shadow-md p-6 col-span-1 md:col-span-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-6 pb-2 border-b border-gray-100",children:"Informasi Profil"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(H,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Nama Lengkap"}),h?e.jsx("input",{type:"text",name:"nama",value:t.nama,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsx("p",{className:"font-medium text-gray-800",children:i.nama||"-"})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(L,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),h?e.jsx("input",{type:"email",name:"email",value:t.email,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsx("p",{className:"font-medium text-gray-800",children:i.email||"-"})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"NIM"}),h?e.jsx("input",{type:"text",name:"nim",value:t.nim,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):e.jsx("p",{className:"font-medium text-gray-800",children:i.nim||"-"})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg text-blue-600",children:e.jsx(q,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Nomor Telepon"}),h?e.jsx("input",{type:"tel",name:"telepon",value:t.telepon,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Masukkan nomor telepon"}):e.jsx("p",{className:"font-medium text-gray-800",children:i.telepon||"-"})]})]})]})]})]})]})}))}export{X as default};
