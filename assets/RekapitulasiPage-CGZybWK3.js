import{r as c,j as e,c as he}from"./index-D7BPkl7L.js";import{L as K}from"./Layout-CvxaU38W.js";import{m as b,u as ue,v as pe,n as R,r as M,s as je,j as N,z as ge,o as be,a as Ne,A as $,x as ye,B as fe}from"./proxy-CFRt1oNv.js";const _e=()=>{var w,v,k,_,S,D,C;const[y,G]=c.useState([]),[O,J]=c.useState([]),[U,X]=c.useState(!0),[u,q]=c.useState(!1),[h,Q]=c.useState("date"),[V,W]=c.useState({}),[p,Y]=c.useState(""),[j,Z]=c.useState("desc"),[ee,g]=c.useState(!1),[l,se]=c.useState(null),ae=[{name:"Mata Kuliah",mobileName:"Matkul",class:"px-1 py-1 max-w-[90px] sm:max-w-[150px]"},{name:"Hari/Jam",mobileName:"Hari/Jam",class:"px-1 py-1 max-w-[70px] sm:max-w-[120px]"},{name:"Kelas/Lab",mobileName:"Kls/Lab",class:"px-1 py-1 max-w-[50px] sm:max-w-[80px]"},{name:"Status",mobileName:"Sts",class:"px-1 py-1"},{name:"Tanggal",mobileName:"Tgl",class:"px-1 py-1"},{name:"Aksi",mobileName:"Act",class:"px-1 py-1"}];JSON.parse(localStorage.getItem("user")),localStorage.getItem("token");const f={hadir:"bg-green-100 text-green-800",izin:"bg-yellow-100 text-yellow-800",alpha:"bg-red-100 text-red-800"},te={A:"bg-red-100 text-red-800",B:"bg-orange-100 text-orange-800",C:"bg-yellow-100 text-yellow-800",D:"bg-green-100 text-green-800",E:"bg-blue-100 text-blue-800"};c.useEffect(()=>{(async()=>{try{const a=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user"));if(!t||!t.id)throw new Error("User data not found");const[i,r]=await Promise.all([fetch(`http://localhost:8080/api/presensi?asisten_id=${t.id}`,{headers:{Authorization:`Bearer ${a}`}}),fetch(`http://localhost:8080/api/rekapitulasi?asisten_id=${t.id}`,{headers:{Authorization:`Bearer ${a}`}})]);if(!i.ok||!r.ok)throw new Error("Failed to fetch data");const[n,x]=await Promise.all([i.json(),r.json()]),m=Array.isArray(n)?n.filter(d=>d.asisten&&d.asisten.id===t.id):n.data?n.data.filter(d=>d.asisten&&d.asisten.id===t.id):[],o=Array.isArray(x)?x.filter(d=>d.asisten&&d.asisten.id===t.id):x.data?x.data.filter(d=>d.asisten&&d.asisten.id===t.id):[];G(m),J(o),q(!0)}catch(a){console.error("Error fetching data:",a)}finally{X(!1)}})()},[]);const le=c.useMemo(()=>{if(!u)return[];let s=[...y];if(p){const a=p.toLowerCase();s=s.filter(t=>{var i,r,n,x,m,o;return((n=(r=(i=t.jadwal)==null?void 0:i.mata_kuliah)==null?void 0:r.nama)==null?void 0:n.toLowerCase().includes(a))||((m=(x=t.jadwal)==null?void 0:x.kelas)==null?void 0:m.toLowerCase().includes(a))||((o=t.status)==null?void 0:o.toLowerCase().includes(a))})}return s.sort((a,t)=>{const i=new Date(a.waktu_input),r=new Date(t.waktu_input);return j==="asc"?i-r:r-i}),s},[y,p,j,u]),ie=()=>{if(!u)return{};const s={};return le.forEach(a=>{var n,x;let t,i,r;h==="matkul"?(i=((x=(n=a.jadwal)==null?void 0:n.mata_kuliah)==null?void 0:x.nama)||"Unknown",t=i):(r=new Date(a.waktu_input).toISOString().split("T")[0],t=r),s[t]||(s[t]={key:t,mataKuliah:h==="matkul"?i:null,date:h==="date"?r:null,items:[]}),s[t].items.push(a)}),s},re=s=>{W(a=>({...a,[s]:!a[s]}))},de=ie(),ne=s=>{se(s),g(!0)},xe=({rekapitulasiData:s})=>e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 sm:gap-3 lg:grid-cols-6",children:s.map(a=>e.jsxs(he.Fragment,{children:[e.jsx("div",{className:"bg-green-50 p-2 rounded-lg border border-green-100 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600",children:"Hadir"}),e.jsx("p",{className:"text-xs font-bold text-green-700 sm:text-sm",children:a.jumlah_hadir})]}),e.jsx("div",{className:"p-1 bg-green-100 rounded-full text-green-600",children:e.jsx(be,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"bg-yellow-50 p-2 rounded-lg border border-yellow-100 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-600",children:"Izin"}),e.jsx("p",{className:"text-xs font-bold text-yellow-700 sm:text-sm",children:a.jumlah_izin})]}),e.jsx("div",{className:"p-1 bg-yellow-100 rounded-full text-yellow-600",children:e.jsx(N,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"bg-red-50 p-2 rounded-lg border border-red-100 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600",children:"Alpha"}),e.jsx("p",{className:"text-xs font-bold text-red-700 sm:text-sm",children:a.jumlah_alpha})]}),e.jsx("div",{className:"p-1 bg-red-100 rounded-full text-red-600",children:e.jsx(R,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"bg-purple-50 p-2 rounded-lg border border-purple-100 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600",children:"Pengganti"}),e.jsx("p",{className:"text-xs font-bold text-purple-700 sm:text-sm",children:a.jumlah_pengganti})]}),e.jsx("div",{className:"p-1 bg-purple-100 rounded-full text-purple-600",children:e.jsx(Ne,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"bg-blue-50 p-2 rounded-lg border border-blue-100 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600",children:"Honor/Pertemuan"}),e.jsxs("p",{className:"text-xs font-bold text-blue-700 sm:text-sm",children:["Rp ",a.honor_pertemuan.toLocaleString()]})]}),e.jsx("div",{className:"p-1 bg-blue-100 rounded-full text-blue-600",children:e.jsx($,{className:"w-3 h-3"})})]})}),e.jsx("div",{className:"bg-indigo-50 p-2 rounded-lg border border-indigo-100 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-indigo-600",children:"Total Honor"}),e.jsxs("p",{className:"text-xs font-bold text-indigo-700 sm:text-sm",children:["Rp ",a.total_honor.toLocaleString()]})]}),e.jsx("div",{className:"p-1 bg-indigo-100 rounded-full text-indigo-600",children:e.jsx($,{className:"w-3 h-3"})})]})})]},a.id))}),ce=({item:s})=>{var a,t,i,r,n,x,m,o,d,A,z,F,L,P,B,T,E,I,H;return e.jsxs("tr",{className:"hover:bg-gray-50 text-xs sm:text-sm",children:[e.jsx("td",{className:"px-2 py-2 max-w-[120px] sm:max-w-[200px] truncate",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"flex-shrink-0 text-purple-600 mr-1 sm:mr-2 text-xs sm:text-sm"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[e.jsx("span",{className:"hidden sm:inline",children:((t=(a=s.jadwal)==null?void 0:a.mata_kuliah)==null?void 0:t.nama)||"N/A"}),e.jsx("span",{className:"sm:hidden",children:(r=(i=s.jadwal)==null?void 0:i.mata_kuliah)!=null&&r.nama?s.jadwal.mata_kuliah.nama.split(" ")[0]+(s.jadwal.mata_kuliah.nama.split(" ").length>1?"...":""):"N/A"})]}),e.jsxs("div",{className:"text-gray-500",children:[e.jsx("span",{className:"hidden sm:inline",children:s.jenis}),e.jsx("span",{className:"sm:hidden",children:(n=s.jenis)==null?void 0:n.charAt(0)})]})]})]})}),e.jsx("td",{className:"px-2 py-2 max-w-[100px] sm:max-w-[150px]",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[e.jsx("span",{className:"hidden sm:inline",children:(x=s.jadwal)==null?void 0:x.hari}),e.jsx("span",{className:"sm:hidden",children:(o=(m=s.jadwal)==null?void 0:m.hari)==null?void 0:o.substring(0,3)})]}),e.jsxs("div",{className:"flex items-center text-gray-500",children:[e.jsx(N,{className:"mr-1"}),e.jsxs("span",{className:"hidden sm:inline",children:[(d=s.jadwal)==null?void 0:d.jam_mulai," - ",(A=s.jadwal)==null?void 0:A.jam_selesai]}),e.jsx("span",{className:"sm:hidden",children:(F=(z=s.jadwal)==null?void 0:z.jam_mulai)==null?void 0:F.replace(":00","")})]})]})}),e.jsxs("td",{className:"px-2 py-2 max-w-[80px] sm:max-w-[120px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"hidden sm:inline",children:(L=s.jadwal)==null?void 0:L.kelas}),e.jsx("span",{className:"sm:hidden",children:(B=(P=s.jadwal)==null?void 0:P.kelas)==null?void 0:B.replace("Kelas ","Kl.")})]}),e.jsxs("div",{className:"text-gray-500",children:[e.jsx("span",{className:"hidden sm:inline",children:(T=s.jadwal)==null?void 0:T.lab}),e.jsx("span",{className:"sm:hidden",children:(I=(E=s.jadwal)==null?void 0:E.lab)==null?void 0:I.split(" ").map(oe=>oe[0]).join("")})]})]}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${f[s.status]||"bg-gray-100 text-gray-800"}`,children:[e.jsx("span",{className:"hidden sm:inline",children:s.status}),e.jsx("span",{className:"sm:hidden",children:s.status==="hadir"?"H":s.status==="izin"?"I":s.status==="alpha"?"A":(H=s.status)==null?void 0:H.charAt(0)})]})}),e.jsxs("td",{className:"px-2 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-gray-700",children:new Date(s.waktu_input).toLocaleDateString("id-ID",{day:"numeric",month:"short"})}),e.jsx("div",{className:"text-gray-500 sm:hidden text-xs",children:new Date(s.waktu_input).toLocaleDateString("id-ID",{year:"2-digit"})})]}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("button",{onClick:()=>ne(s),className:"text-blue-600 hover:text-blue-900 flex items-center justify-center sm:justify-start",children:[e.jsx(fe,{className:"mr-0 sm:mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Detail"})]})})]},s.id)},me=()=>e.jsxs("div",{className:"flex flex-col space-y-2 sm:space-y-0 sm:flex-row sm:space-x-2 w-full",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ye,{className:"text-gray-400 text-sm"})}),e.jsx("input",{type:"text",placeholder:"Cari...",className:"text-xs pl-8 pr-2 py-2 border border-gray-300 rounded-md w-full focus:outline-none focus:ring-1 focus:ring-blue-500",value:p,onChange:s=>Y(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:space-x-2",children:[e.jsxs("select",{className:"text-xs text-gray-700 border border-gray-300 rounded-md px-2 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500",value:h,onChange:s=>Q(s.target.value),children:[e.jsx("option",{value:"date",children:"Tanggal"}),e.jsx("option",{value:"matkul",children:"Matkul"})]}),e.jsxs("select",{className:"text-xs text-gray-700 border border-gray-300 rounded-md px-2 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500",value:j,onChange:s=>Z(s.target.value),children:[e.jsx("option",{value:"desc",children:"Terbaru"}),e.jsx("option",{value:"asc",children:"Terlama"})]})]})]});return U||!u?e.jsx(K,{children:e.jsxs("main",{className:"flex-1 p-4 md:p-6 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Memuat data rekapitulasi..."})]})}):e.jsx(K,{children:e.jsxs(b.main,{className:"flex-1 p-4 sm:p-6 overflow-x-hidden max-w-7xl mx-auto",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[O.map((s,a)=>e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1*a},className:"mb-6 md:mb-8 bg-white rounded-xl shadow-md p-4 md:p-6",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-gray-800 mb-4 md:mb-6 pb-2 border-gray-100",children:"Statistik Presensi"}),e.jsx(xe,{rekapitulasiData:[s]}),e.jsx("div",{className:"mt-3 md:mt-4",children:e.jsxs("span",{className:`px-2 py-1 text-xs md:text-sm leading-5 font-semibold rounded-full ${te[s.tipe_honor]||"bg-gray-100 text-gray-800"}`,children:["Tipe Honor: ",s.tipe_honor]})})]},s.id)),e.jsxs(b.div,{className:"bg-white rounded-xl shadow-md p-4 md:p-6 mb-6 md:mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsxs("div",{className:"flex flex-col space-y-2 md:space-y-0 md:flex-row md:justify-between md:items-center mb-4 md:mb-6",children:[e.jsx("h3",{className:"text-lg md:text-xl font-semibold text-gray-800",children:"Riwayat Presensi"}),e.jsx(me,{})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden overflow-y-auto",style:{maxHeight:"300px"},children:Object.values(de).map(s=>{const a=V[s.key]!==!1;return e.jsxs("div",{children:[e.jsxs("div",{className:"text-black flex justify-between items-center p-3 md:p-4 bg-gray-200 cursor-pointer hover:bg-gray-400",onClick:()=>re(s.key),children:[e.jsx("div",{children:h==="matkul"?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-base md:text-lg font-medium line-clamp-1",children:s.mataKuliah}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-600",children:[s.items.length," presensi"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-base md:text-lg font-medium line-clamp-1",children:new Date(s.date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-600",children:[s.items.length," presensi"]})]})}),a?e.jsx(ue,{}):e.jsx(pe,{})]}),a&&e.jsx("div",{className:"overflow-x-auto text-xs",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:ae.map(t=>e.jsxs("th",{className:`${t.class} text-left text-[0.6rem] sm:text-xs font-medium text-gray-500 uppercase tracking-wider`,children:[e.jsx("span",{className:"hidden sm:inline",children:t.name}),e.jsx("span",{className:"sm:hidden",children:t.mobileName})]},t.name))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items.map(t=>e.jsx(ce,{item:t},t.id))})]})})]},s.key)})})]}),ee&&l&&e.jsx("div",{className:"fixed inset-0 drop-shadow-2xl bg-opacity-30 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center border-b px-4 py-3 md:px-6 md:py-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Detail Presensi"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-500",children:e.jsx(R,{className:"h-5 w-5 md:h-6 md:w-6"})})]}),e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-4 md:mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-500 mb-1 md:mb-2",children:"Mata Kuliah"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"text-purple-600 text-lg"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm md:text-base font-medium text-gray-900",children:((v=(w=l.jadwal)==null?void 0:w.mata_kuliah)==null?void 0:v.nama)||"N/A"}),e.jsx("p",{className:"text-xs text-gray-500",children:l.jenis})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-2 md:p-4 rounded-lg",children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-500 mb-1",children:"Hari/Jam"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(je,{className:"text-gray-400 mr-1 md:mr-2 text-sm"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs md:text-sm font-medium text-gray-900",children:(k=l.jadwal)==null?void 0:k.hari}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(N,{className:"mr-1"}),(_=l.jadwal)==null?void 0:_.jam_mulai," - ",(S=l.jadwal)==null?void 0:S.jam_selesai]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-2 md:p-4 rounded-lg",children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-500 mb-1",children:"Kelas/Lab"}),e.jsx("p",{className:"text-xs md:text-sm font-medium text-gray-900",children:(D=l.jadwal)==null?void 0:D.kelas}),e.jsx("p",{className:"text-xs text-gray-500",children:(C=l.jadwal)==null?void 0:C.lab})]}),e.jsxs("div",{className:"bg-gray-50 p-2 md:p-4 rounded-lg",children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-500 mb-1",children:"Status"}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${f[l.status]||"bg-gray-100 text-gray-800"}`,children:l.status})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:gap-6 mb-4 md:mb-6",children:[l.isi_materi&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-500 mb-1 md:mb-2",children:"Isi Materi"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsx("p",{className:"text-xs md:text-sm text-gray-700",children:l.isi_materi})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-500 mb-1 md:mb-2",children:l.status==="izin"?"Bukti Izin":"Bukti Kehadiran"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:l.bukti_kehadiran||l.bukti_izin?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:l.status==="izin"?"Bukti izin":"Bukti kehadiran"}),e.jsxs("a",{href:l.bukti_kehadiran||l.bukti_izin,download:!0,className:"flex items-center text-blue-600 hover:text-blue-800 text-xs md:text-sm",children:[e.jsx(ge,{className:"mr-1"}),"Download"]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:l.bukti_kehadiran||l.bukti_izin,alt:l.status==="izin"?"Bukti izin":"Bukti kehadiran",className:"max-h-48 md:max-h-64 w-auto object-contain",onError:s=>{s.target.onerror=null,s.target.src="https://via.placeholder.com/400x300?text=Gagal+memuat+gambar"}})})]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Tidak ada bukti"})})]})]}),e.jsx("div",{className:"flex justify-end pt-3 border-t",children:e.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-3 py-1 md:px-4 md:py-2 border border-gray-300 rounded-md text-xs md:text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Tutup"})})]})]})})]})})};export{_e as default};
