import{r,j as e}from"./index-D7BPkl7L.js";import{a as v}from"./index-xsH4HHeE.js";import{L as ee,A as $}from"./Layout-CvxaU38W.js";import{m,n as q,a as M,x as se,w as Q,b as ae,d as te,e as le,C as ie,o as re,D as ne,E as oe}from"./proxy-CFRt1oNv.js";function he(){const[f,E]=r.useState([]),[D,b]=r.useState([]),[de,I]=r.useState(!0),[z,H]=r.useState(null),[R,B]=r.useState(null),[x,V]=r.useState(""),[i,k]=r.useState(null),[W,g]=r.useState(!1),[d,p]=r.useState(!1),[t,F]=r.useState({nama:"",nim:"",email:"",password:"",role:"asisten",status:"aktif",telepon:"",photo:""}),[n,G]=r.useState({}),[S,Y]=r.useState(""),[j,y]=r.useState(!1),[N,A]=r.useState({show:!1,photoUrl:"",userName:""}),T=localStorage.getItem("token"),w=()=>({Authorization:`Bearer ${T}`,"Content-Type":"application/json"});r.useEffect(()=>{O()},[]),r.useEffect(()=>{if(T){const s=JSON.parse(atob(T.split(".")[1]));Y(s.role)}},[]);const O=async()=>{var s,a;I(!0);try{const l=await v.get("http://localhost:8080/api/admin/users",{headers:w()});E(l.data||[]),b(l.data||[])}catch(l){U(`Gagal mengambil data: ${((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||l.message}`)}finally{I(!1)}};r.useEffect(()=>{if(x.trim()==="")b(f);else{const s=f.filter(a=>a.nama.toLowerCase().includes(x.toLowerCase())||a.nim.includes(x)||a.email.toLowerCase().includes(x.toLowerCase())||a.telepon.includes(x));b(s)}},[x,f]);const J=async s=>{var a,l;if(window.confirm("Apakah Anda yakin ingin menghapus user ini?"))try{p(!0),await v.delete(`http://localhost:8080/api/admin/users/${s}`,{headers:w()});const o=f.filter(c=>c.id!==s);E(o),b(o),C("User berhasil dihapus")}catch(o){U(`Gagal menghapus: ${((l=(a=o.response)==null?void 0:a.data)==null?void 0:l.message)||o.message}`)}finally{p(!1)}},K=async s=>{var l,o;const a=s.status.toLowerCase()==="aktif"?"non-aktif":"aktif";try{p(!0),await v.put(`http://localhost:8080/api/admin/users/${s.id}/status`,{status:a},{headers:w()});const c=f.map(h=>h.id===s.id?{...h,status:a}:h);E(c),b(c),C(`Status berhasil diubah menjadi ${a}`)}catch(c){U(`Gagal mengubah status: ${((o=(l=c.response)==null?void 0:l.data)==null?void 0:o.message)||c.message}`)}finally{p(!1)}},u=s=>{const{name:a,value:l}=s.target;F(o=>({...o,[a]:l})),n[a]&&G(o=>({...o,[a]:null}))},Z=()=>{const s={};return t.nama.trim()||(s.nama="Nama wajib diisi"),t.nim.trim()||(s.nim="NIM wajib diisi"),t.email.trim()?/^\S+@\S+\.\S+$/.test(t.email)||(s.email="Email tidak valid"):s.email="Email wajib diisi",t.telepon.trim()?/^[0-9]+$/.test(t.telepon)||(s.telepon="Nomor telepon harus angka"):s.telepon="Nomor telepon wajib diisi",(!i||j)&&!t.password.trim()?s.password="Password wajib diisi":(!i||j)&&t.password.length<6&&(s.password="Password minimal 6 karakter"),G(s),Object.keys(s).length===0},_=async s=>{if(s.preventDefault(),!!Z()){p(!0);try{const a={nama:t.nama,nim:t.nim,email:t.email,telepon:t.telepon,role:t.role,status:t.status,photo:t.photo};(!i||j)&&(a.password=t.password),i?(await v.put(`http://localhost:8080/api/admin/users/${i.id}`,a,{headers:w()}),C("User berhasil diperbarui")):(await v.post("http://localhost:8080/api/admin/users",a,{headers:w()}),C("User berhasil ditambahkan")),O(),g(!1),y(!1)}catch(a){let l="Terjadi kesalahan saat menyimpan data";a.response&&(a.response.status===400?l="Data yang dimasukkan tidak valid":a.response.status===409?l="Email atau NIM sudah terdaftar":l=a.response.data.message||l),U(l)}finally{p(!1)}}},C=s=>{B(s),setTimeout(()=>B(null),3e3)},U=s=>{H(s),setTimeout(()=>H(null),5e3)};r.useEffect(()=>{i?(F({nama:i.nama,nim:i.nim,email:i.email,telepon:i.telepon,password:"",role:i.role,status:i.status}),y(!1)):F({nama:"",nim:"",email:"",telepon:"",password:"",role:"asisten",status:"aktif"})},[i]);const P=D.filter(s=>s.role==="admin"),L=D.filter(s=>s.role==="asisten"),X=({user:s,currentUserRole:a,onEdit:l,onDelete:o,onToggleStatus:c,submitting:h})=>e.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2},className:"py-4 flex justify-between items-center hover:bg-gray-50 px-3 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"relative flex-shrink-0 cursor-pointer",onClick:()=>{A({show:!0,photoUrl:s.photo,userName:s.nama})},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center",children:s.photo?e.jsx("img",{src:s.photo,alt:s.nama,className:"w-full h-full object-cover"}):e.jsx(M,{className:"text-blue-600 w-5 h-5"})}),s.status.toLowerCase()==="aktif"?e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"}):e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-gray-800 truncate",children:s.nama||"-"}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 mt-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["NIM: ",s.nim]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Email: ",s.email]}),e.jsxs("p",{className:"text-sm text-gray-500 hidden sm:inline",children:["Telp: ",s.telepon]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[a==="admin"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-sm font-medium ${s.status.toLowerCase()==="aktif"?"text-green-600":"text-red-600"}`,children:s.status.toLowerCase()==="aktif"?"Aktif":"Non-Aktif"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s.status.toLowerCase()==="aktif",onChange:c,disabled:h}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"})]})]}),a==="admin"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:l,className:"p-2 text-blue-600 hover:bg-blue-50 rounded-full transition-colors",title:"Edit",disabled:h,children:e.jsx(ne,{size:18})}),e.jsx("button",{onClick:o,className:"p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Hapus",disabled:h,children:e.jsx(oe,{size:18})})]})]})]});return e.jsx(ee,{children:e.jsxs("main",{className:"flex-1 p-4 md:p-6 overflow-auto",children:[e.jsx($,{children:N.show&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center drop-shadow-2xl bg-opacity-30 backdrop-blur-sm p-4",onClick:()=>A({show:!1,photoUrl:"",userName:""}),children:e.jsx(m.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-auto",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["Foto Profil ",N.userName]}),e.jsx("button",{onClick:()=>A({show:!1,photoUrl:"",userName:""}),className:"text-gray-500 hover:text-gray-700",children:e.jsx(q,{size:24})})]}),e.jsx("div",{className:"flex justify-center",children:N.photoUrl?e.jsx("img",{src:N.photoUrl,alt:`Profil ${N.userName}`,className:"max-w-full max-h-[70vh] object-contain rounded-lg"}):e.jsx("div",{className:"w-64 h-64 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"text-gray-500 w-32 h-32"})})})]})})})}),e.jsxs(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-blue-900",children:"Data User"}),e.jsxs("div",{className:"w-full md:w-auto flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(se,{className:"text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Cari user...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",value:x,onChange:s=>V(s.target.value)})]}),S==="admin"&&e.jsxs("button",{onClick:()=>{k(null),g(!0)},className:"flex items-center justify-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors whitespace-nowrap",children:[e.jsx(Q,{className:"mr-2"}),"Tambah User"]})]})]}),e.jsxs($,{children:[z&&e.jsx(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0},className:"mb-4 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded",children:e.jsx("p",{children:z})}),R&&e.jsx(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0},className:"mb-4 p-4 bg-green-100 border-l-4 border-green-500 text-green-700 rounded",children:e.jsx("p",{children:R})})]}),W&&e.jsxs(m.div,{className:"bg-white p-6 rounded-xl shadow-md mb-8",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:i?"Edit User":"Tambah User Baru"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(M,{className:"text-gray-400"})}),e.jsx("input",{type:"text",name:"nama",className:`pl-10 w-full p-3 border ${n.nama?"border-red-500":"border-gray-300"} rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition`,value:t.nama,onChange:u,disabled:d})]}),n.nama&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.nama})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NIM"}),e.jsx("input",{type:"text",name:"nim",className:`w-full p-3 border ${n.nim?"border-red-500":"border-gray-300"} rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition`,value:t.nim,onChange:u,disabled:d}),n.nim&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.nim})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ae,{className:"text-gray-400"})}),e.jsx("input",{type:"email",name:"email",className:`pl-10 w-full p-3 border ${n.email?"border-red-500":"border-gray-300"} rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition`,value:t.email,onChange:u,disabled:d})]}),n.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nomor Telepon"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(te,{className:"text-gray-400"})}),e.jsx("input",{type:"text",name:"telepon",className:`pl-10 w-full p-3 border ${n.telepon?"border-red-500":"border-gray-300"} rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition`,value:t.telepon,onChange:u,disabled:d})]}),n.telepon&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.telepon})]}),(!i||j)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),i&&e.jsx("button",{type:"button",onClick:()=>y(!1),className:"text-sm text-gray-500 hover:text-gray-700",children:"Sembunyikan"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(le,{className:"text-gray-400"})}),e.jsx("input",{type:"password",name:"password",className:`pl-10 w-full p-3 border ${n.password?"border-red-500":"border-gray-300"} rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition`,value:t.password,onChange:u,disabled:d,placeholder:i?"Masukkan password baru":""})]}),n.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n.password})]}),i&&!j&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>y(!0),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Ubah Password"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{name:"role",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",value:t.role,onChange:u,disabled:d,children:[e.jsx("option",{value:"asisten",children:"Asisten"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",value:t.status,onChange:u,disabled:d,children:[e.jsx("option",{value:"aktif",children:"Aktif"}),e.jsx("option",{value:"non-aktif",children:"Non-Aktif"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",className:`flex items-center justify-center px-5 py-2.5 rounded-lg ${i?"bg-indigo-600 hover:bg-indigo-700":"bg-blue-600 hover:bg-blue-700"} text-white transition-colors ${d?"opacity-70 cursor-not-allowed":""}`,disabled:d,children:d?e.jsx(ie,{className:"animate-spin mr-2"}):i?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2"}),"Simpan Perubahan"]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2"}),"Tambah User"]})}),e.jsxs("button",{type:"button",onClick:()=>{g(!1),k(null),y(!1)},className:"flex items-center justify-center px-5 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition-colors",disabled:d,children:[e.jsx(q,{className:"mr-2"}),"Batal"]})]})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-6",children:[L.length>0&&e.jsxs(m.div,{className:"flex-1 bg-white p-4 md:p-6 rounded-xl shadow-md",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 md:mb-6",children:[e.jsxs("h2",{className:"text-lg md:text-xl font-semibold text-gray-800 flex items-center",children:[e.jsx("span",{className:"w-2 h-2 md:w-3 md:h-3 bg-blue-500 rounded-full mr-2"}),"Asisten"]}),e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs md:text-sm font-medium px-2 md:px-3 py-1 rounded-full",children:[L.length," Asisten"]})]}),e.jsx("div",{className:"divide-y divide-gray-200 overflow-y-auto",style:{maxHeight:"400px"},children:e.jsx($,{children:L.map(s=>e.jsx(X,{user:s,currentUserRole:S,onEdit:()=>{k(s),g(!0)},onDelete:()=>J(s.id),onToggleStatus:()=>K(s),submitting:d},s.id))})})]}),S==="admin"&&P.length>0&&e.jsxs(m.div,{className:"w-full lg:w-80 xl:w-96 bg-white p-4 md:p-6 rounded-xl shadow-md",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 md:mb-6",children:[e.jsxs("h2",{className:"text-lg md:text-xl font-semibold text-gray-800 flex items-center",children:[e.jsx("span",{className:"w-2 h-2 md:w-3 md:h-3 bg-red-500 rounded-full mr-2"}),"Admin"]}),e.jsxs("span",{className:"bg-red-100 text-red-800 text-xs md:text-sm font-medium px-2 md:px-3 py-1 rounded-full",children:[P.length," Admin"]})]}),e.jsx("div",{className:"divide-y divide-gray-200 overflow-y-auto",style:{maxHeight:"400px"},children:e.jsx($,{children:P.map(s=>e.jsx(X,{user:s,currentUserRole:S,onEdit:()=>{k(s),g(!0)},onDelete:()=>J(s.id),onToggleStatus:()=>K(s),submitting:d},s.id))})})]})]})]})]})})}export{he as default};
