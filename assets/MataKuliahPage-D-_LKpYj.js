import{r as h,j as e}from"./index-D7BPkl7L.js";import{a as y}from"./index-xsH4HHeE.js";import{L as P,A as B}from"./Layout-CvxaU38W.js";import{g as O,m as k,r as V,t as E,s as H,a as X,l as q,o as Q,n as W,u as Y,v as Z,j as ee}from"./proxy-CFRt1oNv.js";function oe(){const[d,p]=h.useState(null),[n,r]=h.useState(null),[v,w]=h.useState({}),[o,f]=h.useState([]),[c,g]=h.useState([]),[l,j]=h.useState(!0),[b,S]=h.useState(null),[m,I]=h.useState(null),[K,C]=h.useState("aktif"),[R,M]=h.useState(!0),[x,A]=h.useState({show:!1,title:"",message:"",type:"info",onConfirm:null});h.useEffect(()=>{(async()=>{M(!0);try{const a=localStorage.getItem("user");if(a){const t=JSON.parse(a);I(t),t.status&&C(t.status);return}const i=localStorage.getItem("token");if(i){const t=JSON.parse(atob(i.split(".")[1]));I(t),localStorage.setItem("user",JSON.stringify(t)),t.status&&C(t.status)}}catch(a){console.error("Error loading user:",a),C("aktif")}finally{M(!1)}})()},[]),h.useEffect(()=>{(async()=>{if(m!=null&&m.id)try{j(!0);const[a,i]=await Promise.all([y.get("http://localhost:8080/api/jadwal",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),y.get("http://localhost:8080/api/asisten-kelas",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})]);f(a.data),g(i.data)}catch(a){S(a.message),console.error("Fetch error:",a)}finally{j(!1)}})()},[m]);const _=async()=>{try{j(!0);const[s,a]=await Promise.all([y.get("http://localhost:8080/api/jadwal",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),y.get("http://localhost:8080/api/asisten-kelas",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})]);f(s.data),g(a.data)}catch(s){S(s.message),console.error("Refresh error:",s)}finally{j(!1)}},D=async s=>{var a,i,t;try{const u=c.find(L=>L.jadwal.id===s&&L.user.id===(m==null?void 0:m.id));if(!u){console.error("Assignment not found"),N({title:"Gagal",message:"Data tidak ditemukan",type:"error"});return}await y.delete(`http://localhost:8080/api/asisten-kelas/${u.jadwal.id}/${u.user.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});const T=await y.get("http://localhost:8080/api/asisten-kelas",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});g(T.data),await _(),N({title:"Berhasil",message:"Pendaftaran berhasil dibatalkan",type:"success"})}catch(u){console.error("Cancel error:",((a=u.response)==null?void 0:a.data)||u),N({title:"Gagal",message:`Gagal membatalkan: ${((t=(i=u.response)==null?void 0:i.data)==null?void 0:t.error)||u.message}`,type:"error"})}},N=({title:s,message:a,type:i="info",onConfirm:t=null})=>{A({show:!0,title:s,message:a,type:i,onConfirm:t||(()=>A({...x,show:!1}))})},$=()=>{A({...x,show:!1})};if(R)return e.jsx("div",{children:"Loading user data..."});if(!(m!=null&&m.id))return e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("p",{className:"text-red-500",children:"User tidak terdeteksi"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-700 text-white rounded",children:"Refresh"})]});if(K==="non-aktif")return e.jsx(P,{children:e.jsx("main",{className:"flex-1 p-6",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-red-200",children:e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mb-4",children:e.jsx(O,{className:"text-red-500 text-2xl"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Status Akun Non-Aktif"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Akun Anda saat ini berstatus non-aktif. Anda tidak dapat melakukan aksi pada halaman ini. Silakan hubungi administrator untuk mengaktifkan akun Anda."}),e.jsx("div",{className:"w-full bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("span",{className:"px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium",children:"Status: Non-Aktif"}),e.jsxs("span",{className:"text-gray-600 text-sm",children:["Nama: ",m.nama]})]})})]})})})})})});const U=o.reduce((s,a)=>{const i=a.mata_kuliah.program_studi.id,t=s.find(u=>u.id===i);return t?t.courses.push({id:a.mata_kuliah.id,name:a.mata_kuliah.nama,code:a.mata_kuliah.kode,semester:a.semester,schedules:[{id:a.id,day:a.hari,time:`${a.jam_mulai} - ${a.jam_selesai}`,lab:a.lab,dosen:a.dosen.nama,kelas:a.kelas,assistants:F(a.id)}]}):s.push({id:i,name:a.mata_kuliah.program_studi.nama,description:`Program studi ${a.mata_kuliah.program_studi.nama}`,color:"from-blue-600 to-indigo-700",courses:[{id:a.mata_kuliah.id,name:a.mata_kuliah.nama,code:a.mata_kuliah.kode,semester:a.semester,schedules:[{id:a.id,day:a.hari,time:`${a.jam_mulai} - ${a.jam_selesai}`,lab:a.lab,dosen:a.dosen.nama,kelas:a.kelas,assistants:F(a.id)}]}]}),s},[]);U.forEach(s=>{const a=[];s.courses.forEach(i=>{const t=a.find(u=>u.id===i.id);t?t.schedules.push(...i.schedules):a.push(i)}),s.courses=a});function F(s){const a=c.filter(i=>i.jadwal_id===s).map(i=>{var t;return((t=i.user)==null?void 0:t.nama)||"-"});for(;a.length<2;)a.push("-");return a}const G=s=>{w(a=>({...a,[s]:!a[s]}))},z=s=>s.filter(a=>a!=="-").length>=2,J=async s=>{var a,i;if(!m){N({title:"Perhatian",message:"Anda harus login terlebih dahulu",type:"error"});return}try{await y.post("http://localhost:8080/api/asisten-kelas",{jadwal_id:s.id,user_id:m.id},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),await _(),N({title:"Berhasil",message:`Berhasil mendaftar sebagai asisten untuk:
${n.name}
${s.day} ${s.time}
Lab: ${s.lab}`,type:"success"});const t=await y.get("http://localhost:8080/api/asisten-kelas",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});g(t.data)}catch(t){N({title:"Gagal",message:`Gagal mendaftar: ${((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.message)||t.message}`,type:"error"})}};return l?e.jsx(P,{children:e.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Memuat data jadwal..."})]})})}):b?e.jsxs("div",{className:"flex min-h-screen min-w-screen bg-gray-50",children:[e.jsx(SidebarMenu,{}),e.jsx("main",{className:"flex-1 p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsxs("p",{children:["Gagal memuat data: ",b]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Coba Lagi"})]})})]}):e.jsxs(P,{children:[e.jsx("main",{className:"flex-1 p-6",children:e.jsx(B,{children:d?n?e.jsx(te,{selectedCourse:n,setSelectedCourse:r,takenSchedules:c,user:m,handleTakeSchedule:J,handleCancelSchedule:D,isFull:z,refreshData:_,showModal:N}):e.jsx(se,{selectedProgram:d,setSelectedProgram:p,setSelectedCourse:r,openSemesters:v,toggleSemester:G,isFull:z}):e.jsx(ae,{programs:U,setSelectedProgram:p})})}),e.jsx(B,{children:x.show&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 drop-shadow-2xl bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-50",onClick:$,children:e.jsx(k.div,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},className:`bg-white rounded-lg shadow-xl max-w-md w-full mx-4 ${x.type==="error"?"border-l-4 border-red-500":x.type==="success"?"border-l-4 border-green-500":"border-l-4 border-blue-500"}`,onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:`text-xl font-bold mb-2 ${x.type==="error"?"text-red-600":x.type==="success"?"text-green-600":"text-blue-600"}`,children:x.title}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:x.message}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:$,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors",children:"Tutup"}),x.onConfirm&&x.onConfirm!==$&&e.jsx("button",{onClick:()=>{x.onConfirm(),$()},className:`px-4 py-2 text-white rounded ${x.type==="error"?"bg-red-500 hover:bg-red-600":x.type==="success"?"bg-green-500 hover:bg-green-600":"bg-blue-500 hover:bg-blue-600"} transition-colors`,children:"Konfirmasi"})]})]})})})})]})}function ae({programs:d,setSelectedProgram:p}){return e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},className:"max-w-3xl mx-auto",children:[e.jsx("div",{className:"flex items-center mb-6",children:e.jsxs("div",{className:"ml-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Pilih Program Studi"}),e.jsx("p",{className:"text-gray-600",children:"Silakan pilih program studi untuk melihat daftar mata kuliah"})]})}),e.jsx("div",{className:"grid gap-6",children:d.map(n=>e.jsx(k.div,{whileHover:{y:-5},className:`bg-gradient-to-r ${n.color} text-white rounded-xl shadow-lg overflow-hidden cursor-pointer`,onClick:()=>p(n),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:n.name}),e.jsx("p",{className:"text-sm opacity-90",children:n.description})]}),e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(V,{className:"text-xl"})})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs bg-white/20 px-2 py-1 rounded-full",children:[n.courses.length," Mata Kuliah"]}),e.jsxs("span",{className:"text-xs opacity-90",children:["Semester ",Math.min(...n.courses.map(r=>r.semester))," - ",Math.max(...n.courses.map(r=>r.semester))]})]})]})},n.id))})]})}function se({selectedProgram:d,setSelectedProgram:p,setSelectedCourse:n,openSemesters:r,toggleSemester:v,isFull:w}){return e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>p(null),className:"flex items-center text-gray-500 hover:text-gray-700 transition-colors p-1 rounded-full hover:bg-gray-100",children:e.jsx(E,{className:"text-2xl"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:d.name}),e.jsx("p",{className:"text-gray-600",children:d.description})]})]}),e.jsx("div",{className:"space-y-4",children:Array.from(new Set(d.courses.map(o=>o.semester))).sort().map(o=>{const f=d.courses.filter(c=>c.semester===o);return f.length===0?null:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200",children:[e.jsxs("button",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 w-full flex justify-between items-center px-6 py-4 text-left hover:bg-blue-700 transition-colors",onClick:()=>v(o),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"font-semibold text-white",children:["Semester ",o]}),e.jsxs("span",{className:"ml-3 px-2 py-1 bg-gray-800 text-gray-300 text-xs rounded-full",children:[f.length," Mata Kuliah"]})]}),r[o]?e.jsx(Y,{className:"text-gray-500"}):e.jsx(Z,{className:"text-gray-500"})]}),e.jsx(B,{children:r[o]&&e.jsx(k.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"px-6 divide-y divide-gray-100",children:f.map(c=>e.jsxs("div",{className:"py-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>n(c),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[c.code," • Semester ",c.semester]})]}),e.jsxs("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded-full",children:["S",o]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:c.schedules.map(g=>e.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-medium flex items-center ${w(g.assistants)?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:[e.jsx(ee,{className:"mr-1",size:12}),g.day," ",g.time]},g.id))})]},c.id))})})]},o)})})]})}function te({selectedCourse:d,setSelectedCourse:p,takenSchedules:n,user:r,handleTakeSchedule:v,handleCancelSchedule:w,isFull:o,showModal:f}){const c=l=>!(r!=null&&r.id)||!n.length?!1:n.some(b=>b.jadwal_id===l&&b.asisten_id===r.id),g=l=>{f({title:"Konfirmasi",message:"Apakah Anda yakin ingin membatalkan pendaftaran?",type:"info",onConfirm:()=>w(l)})};return e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:()=>p(null),className:"flex items-center text-blue-600 hover:text-blue-800 transition-colors",children:e.jsx(E,{className:"mr-1"})}),e.jsx("h2",{className:"text-2xl font-bold ml-4 text-gray-800",children:d.name}),e.jsxs("span",{className:"ml-4 px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:[d.code," • Semester ",d.semester]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-purple-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Jadwal Tersedia"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pilih jadwal yang tersedia untuk mengambil mata kuliah ini"})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:d.schedules.map(l=>{const j=c(l.id);return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"mb-4 md:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(H,{className:"text-blue-500 mr-2"}),e.jsxs("span",{className:"font-medium text-gray-800",children:[l.day,", ",l.time]}),j&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full",children:"Anda terdaftar"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm",children:[e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full",children:l.lab}),e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full",children:["Kelas ",l.kelas]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-700",children:[e.jsx(X,{className:"mr-2 text-gray-500"}),e.jsx("span",{children:l.dosen})]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-700 mb-1",children:[e.jsx(q,{className:"mr-2 text-gray-500"}),e.jsx("span",{children:"Asisten:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.assistants.map((b,S)=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${b==="-"?"bg-gray-100 text-gray-500":"bg-green-100 text-green-800"}`,children:b},S))})]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end gap-2",children:j?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"px-4 py-2 bg-green-100 text-green-800 rounded-lg font-medium flex items-center",children:[e.jsx(Q,{className:"mr-1"})," Terdaftar"]}),e.jsxs("button",{onClick:()=>g(l.id),className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg flex items-center transition-colors",children:[e.jsx(W,{className:"mr-1"})," Batalkan"]})]}):e.jsx("button",{onClick:()=>v(l),disabled:o(l.assistants)||!(r!=null&&r.id),className:`px-5 py-2 rounded-lg font-medium ${o(l.assistants)||!(r!=null&&r.id)?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"} transition-colors`,children:r!=null&&r.id?o(l.assistants)?"Kuota Penuh":"Ambil Jadwal":"Login untuk Mendaftar"})})]},l.id)})})]})]})}export{oe as default};
