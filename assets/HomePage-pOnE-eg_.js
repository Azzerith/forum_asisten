import{r as d,j as e}from"./index-D7BPkl7L.js";import{g as G,m as g,h as q,i as Q,F as V,j as X,k as $,l as z}from"./proxy-CFRt1oNv.js";import{L as v}from"./Layout-CvxaU38W.js";import{a as B}from"./index-xsH4HHeE.js";function le(){const[L,_]=d.useState([]),[Y,S]=d.useState(!0),[s,C]=d.useState(null),[U,I]=d.useState([]),[Z,ee]=d.useState(!0),[f,A]=d.useState("aktif"),[J,P]=d.useState(!0),[te,ae]=d.useState([]);d.useEffect(()=>{(async()=>{P(!0);try{const r=localStorage.getItem("user");if(r){const o=JSON.parse(r);C(o),A((o.status||"aktif").toLowerCase());return}const l=localStorage.getItem("token");if(l){const o=JSON.parse(atob(l.split(".")[1]));C(o),localStorage.setItem("user",JSON.stringify(o)),A((o.status||"aktif").toLowerCase())}}catch(r){console.error("Error loading user:",r),A("aktif")}finally{P(!1)}})()},[]);const O=n=>{if(n instanceof Date||(n=new Date(n)),isNaN(n.getTime()))return"Waktu tidak tersedia";const l=Math.floor((new Date-n)/1e3),o=Math.floor(l%60),u=Math.floor(l/60%60),p=Math.floor(l/(60*60)%24),x=Math.floor(l/(60*60*24)),a=Math.floor(x/30),i=Math.floor(x/365);return i>0?`${i} tahun yang lalu`:a>0?`${a} bulan yang lalu`:x>0?`${x} hari yang lalu`:p>0?`${p} jam yang lalu`:u>0?`${u} menit yang lalu`:`${o} detik yang lalu`};d.useEffect(()=>{if(!(s!=null&&s.id)||f==="non-aktif")return;(async()=>{try{S(!0);const r=await B.get("http://localhost:8080/api/presensi?limit=20",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=(s==null?void 0:s.id)||JSON.parse(atob(localStorage.getItem("token").split(".")[1])).id,u=r.data.filter(a=>Number(a.user_id)===Number(l)||Number(a.asisten_id)===Number(l)&&a.waktu_input).map(a=>{var t,c,m;const i=new Date(a.waktu_input);return isNaN(i.getTime())?(console.warn("Invalid date in presensi:",a.waktu_input),null):{type:"presensi",id:a.id,title:`Presensi ${a.status||"tidak diketahui"}`,description:`${((c=(t=a.jadwal)==null?void 0:t.mata_kuliah)==null?void 0:c.nama)||"Mata Kuliah"} - ${((m=a.jadwal)==null?void 0:m.kelas)||"Kelas"}`,time:O(i),date:i.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),rawDate:i.toISOString().split("T")[0],icon:e.jsx(V,{className:"text-green-500"}),createdAt:i.getTime()}}).filter(Boolean);u.sort((a,i)=>i.createdAt-a.createdAt);const p=u.reduce((a,i)=>(a[i.rawDate]||(a[i.rawDate]={date:i.date,activities:[]}),a[i.rawDate].activities.push(i),a),{}),x=Object.values(p).sort((a,i)=>new Date(i.activities[0].rawDate)-new Date(a.activities[0].rawDate));I(x)}catch(r){console.error("Error fetching activities:",r),I([])}finally{S(!1)}})()},[s==null?void 0:s.id,f]),d.useEffect(()=>{if(!(s!=null&&s.id)||f==="non-aktif")return;(async()=>{try{const r=await B.get(`http://localhost:8080/api/asisten-kelas?asisten_id=${s.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=(Array.isArray(r.data)?r.data:[r.data]).filter(t=>{var c;return t.asisten_id===Number(s.id)||((c=t.asisten)==null?void 0:c.id)===Number(s.id)}),p=new Date().toLocaleDateString("id-ID",{weekday:"long"}).toLowerCase(),x=o.filter(t=>{var m,h,j;return(((h=(m=t.jadwal)==null?void 0:m.hari)==null?void 0:h.toLowerCase())||((j=t.hari)==null?void 0:j.toLowerCase()))===p}),a=(t,c=0,m=0)=>{var M,F,E,H,R;const h=new Date,j=h.toLocaleDateString("id-ID",{weekday:"long"}).toLowerCase(),k=h.getHours()*60+h.getMinutes();if((((F=(M=t.jadwal)==null?void 0:M.hari)==null?void 0:F.toLowerCase())||((E=t.hari)==null?void 0:E.toLowerCase()))!==j)return!1;const[y,b]=(((H=t.jadwal)==null?void 0:H.jam_mulai)||t.jam_mulai).split(":").map(Number),[N,w]=(((R=t.jadwal)==null?void 0:R.jam_selesai)||t.jam_selesai).split(":").map(Number),W=y*60+b,K=N*60+w;return k>=W-c&&k<=K+m},i=[];x.forEach(t=>{var k,D,y,b,N,w;const c=((D=(k=t.jadwal)==null?void 0:k.mata_kuliah)==null?void 0:D.nama)||((y=t.mata_kuliah)==null?void 0:y.nama),m=((b=t.jadwal)==null?void 0:b.kelas)||t.kelas,h=((N=t.jadwal)==null?void 0:N.jam_mulai)||t.jam_mulai,j=((w=t.jadwal)==null?void 0:w.jam_selesai)||t.jam_selesai;a(t,30,30)&&i.push({title:"Waktu Presensi!",description:`Segera lakukan presensi untuk ${c} - ${m}`,icon:e.jsx(X,{className:"text-xl"}),color:"bg-blue-100 text-blue-600",urgent:!0}),a(t,60,0)&&i.push({title:"Pengingat Presensi",description:`Presensi untuk ${c} - ${m} akan dimulai pukul ${h}`,icon:e.jsx($,{className:"text-xl"}),color:"bg-orange-100 text-orange-600"})}),i.length===0&&i.push({title:"Rapat Koordinator",description:"Akan diadakan rapat koor rutin 3 minggu sekali pada Hari Jumat pukul 10.00",icon:e.jsx(z,{className:"text-xl"}),color:"bg-indigo-100 text-indigo-600"},{title:"Pengumuman!",description:"1. Ambil jadwal terlebih dahulu sesuai ketentuan Forum Asisten. 2. Selalu pastikan anda telah presensi sesuai jadwal yang anda ambil. 3. Cek secara berkala hasil rekapitulasi",icon:e.jsx($,{className:"text-xl"}),color:"bg-purple-100 text-purple-600"}),_(i)}catch(r){console.error("Failed to fetch schedules",r),_([{title:"Meeting Rutin",description:"Akan diadakan meeting rutin hari Jumat pukul 16.00",icon:e.jsx(z,{className:"text-xl"}),color:"bg-indigo-100 text-indigo-600"},{title:"Pengumuman!",description:"Diberitahukan kepada seluruh asisten mata kuliah Pemrograman...",icon:e.jsx($,{className:"text-xl"}),color:"bg-purple-100 text-purple-600"}])}finally{S(!1)}})()},[s==null?void 0:s.id,f]);const T=n=>{console.log("Activity detail:",n)};return J?e.jsx(v,{children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"})})}):s!=null&&s.id?f==="non-aktif"?e.jsx(v,{children:e.jsxs("main",{className:"flex-1 p-6",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-800 mb-2",children:["Selamat Datang, ",s.nama,"!"]}),e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-red-200",children:e.jsx("div",{className:"p-6 md:p-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mb-4",children:e.jsx(G,{className:"text-red-500 text-2xl"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Status Akun Non-Aktif"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Akun Anda saat ini berstatus non-aktif. Anda tidak dapat melakukan aksi pada halaman ini. Silakan hubungi administrator untuk mengaktifkan akun Anda."}),e.jsx("div",{className:"w-full bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("span",{className:"px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium",children:"Status: Non-Aktif"}),e.jsxs("span",{className:"text-gray-600 text-sm",children:["Nama: ",s.nama]})]})})]})})})})]})}):e.jsx(v,{children:e.jsxs(g.main,{className:"flex-1 p-4 sm:p-6 overflow-x-hidden max-w-7xl mx-auto",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsxs(g.header,{className:"mb-6 sm:mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800",children:["Selamat Datang, ",s.nama,"!"]}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"Berikut update terbaru untuk Anda"})]}),e.jsx("section",{className:"mb-8 sm:mb-10",children:L.length>0?e.jsx("div",{className:"grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",style:{maxWidth:"1300px"},children:L.map((n,r)=>e.jsxs(g.article,{className:`relative ${n.urgent?"bg-gradient-to-r from-pink-600 to-violet-900":"bg-gradient-to-r from-blue-600 to-indigo-700"} text-white p-5 rounded-xl shadow-lg overflow-hidden z-0`,style:{maxHeight:"200px"},initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2+r*.1,duration:.3},whileHover:{y:-5},children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-2xl",children:n.icon}),e.jsx("h2",{className:"text-lg font-semibold",children:n.title})]}),e.jsx("p",{className:"text-xs md:text-sm opacity-90 mb-4",children:n.description}),n.urgent?e.jsxs(g.button,{className:"flex items-center gap-1 text-xs bg-white/20 hover:bg-white/30 px-3 py-1.5 rounded-full transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>window.location.href="/presensi",children:["Presensi Sekarang ",e.jsx(q,{className:"text-xs"})]}):e.jsx("div",{})]}),n.urgent&&e.jsx("div",{className:"absolute inset-0 overflow-hidden z-1",children:e.jsx("style",{jsx:!0,children:`
                        &::before {
                          content: '';
                          position: absolute;
                          top: 0;
                          left: -100%;
                          width: 100%;
                          height: 100%;
                          background: linear-gradient(
                            90deg,
                            transparent,
                            rgba(255, 255, 255, 0.4),
                            transparent
                          );
                          animation: shimmer 2s infinite;
                          z-index: 1;
                        }
                        
                        @keyframes shimmer {
                          100% {
                            left: 100%;
                          }
                        }
                      `})})]},r))}):e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3 text-yellow-600",children:[e.jsx(Q,{className:"text-xl"}),e.jsx("p",{children:"Tidak ada pengumuman saat ini"})]})})}),e.jsxs(g.section,{className:"bg-white rounded-xl shadow-sm overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},onClick:()=>window.location.href="/rekapitulasi",children:[e.jsxs("div",{className:"p-5 sm:p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-800",children:"Aktivitas Terkini"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Riwayat aktivitas terbaru Anda"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:U.length>0?e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"200px"},children:U.map((n,r)=>e.jsxs("div",{className:"py-2",children:[e.jsx("div",{className:"px-5 py-3 text-sm font-medium text-gray-500 sticky top-0 bg-gray-50 z-10",children:n.date}),n.activities.map((l,o)=>e.jsx(g.div,{className:"p-4 sm:p-5 hover:bg-gray-50 transition-colors cursor-pointer",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1+o*.05},onClick:()=>T(l),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"bg-blue-100 text-blue-600 p-2 rounded-full flex-shrink-0 mt-1",children:l.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm sm:text-base font-medium text-gray-800 mb-1",children:l.title}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-1",children:l.description}),e.jsx("p",{className:"text-xs text-gray-500",children:l.time})]}),e.jsx("button",{className:"text-xs text-blue-600 hover:text-blue-800 flex-shrink-0",onClick:u=>{u.stopPropagation(),T(l)},children:"Detail"})]})},`${l.type}-${l.id}`))]},r))}):e.jsx(g.div,{className:"p-4 sm:p-5",initial:{opacity:0},animate:{opacity:1},children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Belum ada aktivitas terbaru"})})})})]})]})}):e.jsx(v,{children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("p",{className:"text-red-500",children:"User tidak terdeteksi"})})})}export{le as default};
